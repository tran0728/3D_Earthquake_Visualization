var C=Object.defineProperty;var S=(d,e,i)=>e in d?C(d,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[e]=i;var r=(d,e,i)=>(S(d,typeof e!="symbol"?e+"":e,i),i);import{W as E,S as _,P as U,C as q,V as F,M as b,a as V,b as y,c as A,d as w,G as R,e as B,T as L,L as G,F as M,f,g as W,h as H,i as N,D as K}from"./vendor.js";const j=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}};j();class O{constructor(e=60,i=1.333,a=1,t=1e3){r(this,"aspectRatio");r(this,"fov");r(this,"znear");r(this,"zfar");r(this,"renderer");r(this,"scene");r(this,"camera");r(this,"clock");this.fov=e,this.aspectRatio=i,this.znear=a,this.zfar=t,this.renderer=new E,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",s=>{this.onMouseDown(s)}),window.addEventListener("mouseup",s=>{this.onMouseUp(s)}),window.addEventListener("mousemove",s=>{this.onMouseMove(s)}),window.addEventListener("keydown",s=>{this.onKeyDown(s)}),window.addEventListener("keyup",s=>{this.onKeyUp(s)}),this.scene=new _,this.camera=new U(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new q}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new F;this.renderer.getViewport(e);var i=window.innerWidth/window.innerHeight;this.aspectRatio>i?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onKeyDown(e){}onKeyUp(e){}}class v extends b{constructor(e,i,a,t){super();r(this,"startTime");r(this,"duration");r(this,"magnitude");r(this,"mapPosition");r(this,"globePosition");r(this,"position");this.startTime=a.date.getTime(),this.magnitude=a.normalizedMagnitude,this.duration=t,this.mapPosition=i,this.globePosition=e,this.position=i,this.geometry=new V(.1*this.magnitude);var s=new y;s.color=new A(1*this.magnitude,1-this.magnitude,0),this.material=s}getPlaybackLife(e){return w.clamp(Math.abs(e/1e3-this.startTime/1e3)/this.duration,0,1)}}class Q extends R{constructor(){super();r(this,"earthMesh");r(this,"earthMaterial");r(this,"debugMaterial");r(this,"vertices");r(this,"sphere_vertices");r(this,"normals");r(this,"sphere_normals");r(this,"globeMode");r(this,"alpha");r(this,"morph_me");this.earthMesh=new b,this.earthMaterial=new y,this.debugMaterial=new B,this.vertices=[],this.sphere_vertices=[],this.normals=[],this.sphere_normals=[],this.globeMode=!1,this.alpha=0,this.morph_me=!1}initialize(){this.earthMaterial.map=new L().load("./data/earth-1k.png"),this.earthMaterial.map.minFilter=G,this.earthMesh.material=this.earthMaterial,this.debugMaterial.wireframe=!0;var e=-Math.PI,i=Math.PI/2,a=2*Math.PI/80,t=Math.PI/80,s=0,o=[];for(let h=0;h<80;h++)for(let n=0;n<80;n++)this.vertices.push(e+a*n,i-h*t,0),this.vertices.push(e+a+a*n,i-h*t,0),this.vertices.push(e+a+a*n,i+t-h*t,0),this.vertices.push(e+a*n,i+t-t*h,0),this.normals.push(0,0,1),this.normals.push(0,0,1),this.normals.push(0,0,1),this.normals.push(0,0,1);for(let h=0;h<80;h++)for(let n=0;n<80;n++){var l=this.rescale(e+a*n,0,Math.PI,0,180),T=this.rescale(i-h*t,0,Math.PI/2,0,90),P=this.rescale(e+a+a*n,0,Math.PI,0,180),k=this.rescale(i-h*t,0,Math.PI/2,0,90),D=this.rescale(e+a+a*n,0,Math.PI,0,180),I=this.rescale(i+t-h*t,0,Math.PI/2,0,90),z=this.rescale(e+a*n,0,Math.PI,0,180),x=this.rescale(i+t-t*h,0,Math.PI/2,0,90),u=this.convertLatLongToSphere(T,l),c=this.convertLatLongToSphere(k,P),m=this.convertLatLongToSphere(I,D),p=this.convertLatLongToSphere(x,z);this.sphere_vertices.push(u.x,u.y,u.z),this.sphere_vertices.push(c.x,c.y,c.z),this.sphere_vertices.push(m.x,m.y,m.z),this.sphere_vertices.push(p.x,p.y,p.z),this.sphere_normals.push(u.x,u.y,u.z),this.sphere_normals.push(c.x,c.y,c.z),this.sphere_normals.push(m.x,m.y,m.z),this.sphere_normals.push(p.x,p.y,p.z)}for(let h=0;h<80;h++)for(let n=0;n<80;n++)o.push(s*4+1,s*4+3,s*4),o.push(s*4+1,s*4+2,s*4+3),s++;var g=[];for(let h=0;h<80;h++)for(let n=0;n<80;n++)g.push(n/80,1-h/80),g.push((n+1)/80,1-h/80),g.push((n+1)/80,1-(h-1)/80),g.push(n/80,1-(h-1)/80);this.earthMesh.geometry.setAttribute("position",new M(this.vertices,3)),this.earthMesh.geometry.setAttribute("normal",new M(this.normals,3)),this.earthMesh.geometry.setAttribute("uv",new M(g,2)),this.earthMesh.geometry.setIndex(o),this.add(this.earthMesh)}rescale(e,i,a,t,s){return t+(s-t)*(e-i)/(a-i)}update(e){this.morph_me&&this.morph(e)}morph(e){if(this.alpha+=e,this.alpha>1){this.morph_me=!1,this.alpha=0;return}var i=[],a=[];if(this.globeMode==!0)for(let t=0;t<6400*15;t++)a.push(w.lerp(this.vertices[t],this.sphere_vertices[t],this.alpha)),i.push(w.lerp(this.normals[t],this.sphere_normals[t],this.alpha));if(this.globeMode==!1)for(let t=0;t<6400*15;t++)a.push(w.lerp(this.sphere_vertices[t],this.vertices[t],this.alpha)),i.push(w.lerp(this.sphere_normals[t],this.normals[t],this.alpha));this.earthMesh.geometry.setAttribute("position",new M(a,3)),this.earthMesh.geometry.setAttribute("normal",new M(i,3))}animateEarthquakes(e){this.children.forEach(i=>{i instanceof v&&(this.morph_me&&(this.globeMode==!0&&i.position.lerpVectors(i.mapPosition,i.globePosition,this.alpha),this.globeMode==!1&&i.position.lerpVectors(i.globePosition,i.mapPosition,this.alpha)),this.morph_me||(this.globeMode==!0&&(i.position=i.globePosition),this.globeMode==!1&&(i.position=i.mapPosition)),i.getPlaybackLife(e)==1&&this.remove(i))})}createEarthquake(e){var a=this.convertLatLongToSphere(e.latitude,e.longitude),t=this.convertLatLongToPlane(e.latitude,e.longitude),s=new v(a,t,e,29030400);this.add(s)}convertLatLongToPlane(e,i){var a=e/90,t=i/180,s=t*Math.PI,o=a*(Math.PI/2);return new f(s,o,0)}convertLatLongToSphere(e,i){var a=e*Math.PI/180,t=i*Math.PI/180,s=Math.cos(a)*Math.sin(t),o=Math.sin(a),l=Math.cos(a)*Math.cos(t);return new f(s,o,l)}toggleDebugMode(e){e?this.earthMesh.material=this.debugMaterial:this.earthMesh.material=this.earthMaterial}}class Y{constructor(e){r(this,"date");r(this,"longitude");r(this,"latitude");r(this,"magnitude");r(this,"normalizedMagnitude");this.date=new Date,this.date.setUTCFullYear(parseInt(e.substring(12,16))),this.date.setUTCMonth(parseInt(e.substring(17,19))),this.date.setUTCDate(parseInt(e.substring(20,22))),this.date.setUTCHours(parseInt(e.substring(24,26))),this.date.setUTCMinutes(parseInt(e.substring(27,29))),this.date.setUTCSeconds(parseFloat(e.substring(30,35))),this.longitude=parseFloat(e.substring(44,52)),this.latitude=parseFloat(e.substring(37,44)),this.magnitude=parseFloat(e.substring(66,70)),this.normalizedMagnitude=this.magnitude}}class ${constructor(e){r(this,"earthquakes");r(this,"loaded");r(this,"maxMagnitude");r(this,"minMagnitude");r(this,"nextIndex");this.earthquakes=[],this.loaded=!1,this.maxMagnitude=0,this.minMagnitude=1/0,this.nextIndex=0;var i=new W;i.load(e,a=>{var t=a.toString().split(`
`);t.forEach(s=>{if(s.length>30){var o=new Y(s);this.earthquakes.push(o),o.magnitude>this.maxMagnitude?this.maxMagnitude=o.magnitude:o.magnitude<this.minMagnitude&&(this.minMagnitude=o.magnitude)}}),this.earthquakes.forEach(s=>{s.normalizedMagnitude=(s.magnitude-this.minMagnitude)/(this.maxMagnitude-this.minMagnitude)}),this.loaded=!0})}reset(){this.nextIndex=0}getNextQuake(e){for(var i=e.getTime();this.nextIndex<this.earthquakes.length;)return this.earthquakes[this.nextIndex].date.getTime()<i?(this.nextIndex++,this.earthquakes[this.nextIndex-1]):null;return null}getMaxTime(){return this.earthquakes[this.earthquakes.length-1].date.getTime()}getMinTime(){return this.earthquakes[0].date.getTime()}}class J extends O{constructor(){super(60,1920/1080,.1,50);r(this,"earth");r(this,"gui");r(this,"earthquakeDB");r(this,"currentTime");r(this,"mouseDrag");r(this,"mouseVector");r(this,"date");r(this,"viewMode");r(this,"playbackSpeed");r(this,"debugMode");this.gui=new H,this.earth=new Q,this.earthquakeDB=new $("./data/earthquakes.txt"),this.currentTime=1/0,this.mouseDrag=!1,this.mouseVector=new N,this.date="",this.viewMode="Map",this.playbackSpeed=.5,this.debugMode=!1}createScene(){this.camera.position.set(0,0,3.25),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);var e=new K("white",1.5);e.position.set(10,10,15),this.scene.add(e),this.scene.background=new L().load("./data/stars.png"),this.earth.initialize(),this.scene.add(this.earth);var i=this.gui.addFolder("Earthquake Controls"),a=i.add(this,"date");a.name("Current Date"),a.listen();var t=i.add(this,"viewMode",{Map:"Map",Globe:"Globe"});t.name("View Mode"),t.onChange(l=>{l=="Map"&&(this.earth.globeMode=!1,this.earth.morph_me=!0),l=="Globe"&&(this.earth.morph_me=!0,this.earth.globeMode=!0)});var s=i.add(this,"playbackSpeed",0,1);s.name("Playback Speed");var o=i.add(this,"debugMode");o.name("Debug Mode"),o.onChange(l=>{this.toggleDebugMode(l)}),this.gui.width=300,i.open()}update(e){if(!this.earthquakeDB.loaded)return;const i=3e10;this.currentTime+=i*this.playbackSpeed*e,this.currentTime>this.earthquakeDB.getMaxTime()&&(this.currentTime=this.earthquakeDB.getMinTime(),this.earthquakeDB.reset());var a=new Date;a.setTime(this.currentTime),this.date=a.getUTCMonth()+"/"+a.getUTCDate()+"/"+a.getUTCFullYear();for(var t=this.earthquakeDB.getNextQuake(a);t;)this.earth.createEarthquake(t),t=this.earthquakeDB.getNextQuake(a);this.earth.update(e),this.earth.animateEarthquakes(this.currentTime)}toggleDebugMode(e){this.earth.toggleDebugMode(e)}onMouseDown(e){this.mouseDrag=!0}onMouseUp(e){this.mouseDrag=!1}onMouseMove(e){this.mouseDrag,this.mouseVector.set(e.x,e.y)}}var X=new J;X.start();
